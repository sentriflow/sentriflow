!
! Cisco IOS Routing Protocols Configuration
! Covers: BGP (address-family, VRF), OSPF, EIGRP, ISIS, prefix-lists, route-maps
!
hostname EDGE-RTR-01
!
vrf definition RED
rd 65000:1
address-family ipv4
route-target export 65000:1
route-target import 65000:1
exit-address-family
address-family ipv6
route-target export 65000:1
route-target import 65000:1
exit-address-family
!
vrf definition BLUE
rd 65000:2
address-family ipv4
route-target export 65000:2
route-target import 65000:2
exit-address-family
!
interface Loopback0
ip address 192.168.255.1 255.255.255.255
ip router isis CORE
!
interface GigabitEthernet0/0
ip address 10.0.0.1 255.255.255.252
ip router isis CORE
isis circuit-type level-2-only
!
router isis CORE
net 49.0001.1921.6825.5001.00
is-type level-2-only
metric-style wide
log-adjacency-changes
passive-interface Loopback0
!
router ospf 1
router-id 192.168.255.1
auto-cost reference-bandwidth 10000
area 0 authentication message-digest
passive-interface default
no passive-interface GigabitEthernet0/0
network 0.0.0.0 255.255.255.255 area 0
!
router eigrp NAMED-EIGRP
address-family ipv4 unicast autonomous-system 100
network 10.0.0.0 0.255.255.255
eigrp router-id 192.168.255.1
af-interface default
passive-interface
exit-af-interface
af-interface GigabitEthernet0/0
no passive-interface
authentication mode md5
authentication key-chain EIGRP-KEY
exit-af-interface
topology base
redistribute static
exit-af-topology
exit-address-family
!
router bgp 65000
bgp router-id 192.168.255.1
bgp bestpath as-path multipath-relax
bgp log-neighbor-changes
no bgp default ipv4-unicast
neighbor IBGP peer-group
neighbor IBGP remote-as 65000
neighbor IBGP update-source Loopback0
neighbor EBGP peer-group
neighbor EBGP remote-as 65001
neighbor 192.168.255.2 peer-group IBGP
neighbor 192.168.255.3 peer-group IBGP
neighbor 10.0.0.2 peer-group EBGP
!
address-family ipv4 unicast
neighbor IBGP activate
neighbor IBGP send-community both
neighbor IBGP next-hop-self
neighbor EBGP activate
neighbor EBGP route-map IMPORT-EBGP in
neighbor EBGP route-map EXPORT-EBGP out
maximum-paths 4
maximum-paths ibgp 4
exit-address-family
!
address-family vpnv4 unicast
neighbor IBGP activate
neighbor IBGP send-community extended
exit-address-family
!
address-family ipv4 vrf RED
redistribute connected
redistribute static
neighbor 172.16.1.2 remote-as 65100
neighbor 172.16.1.2 activate
neighbor 172.16.1.2 as-override
exit-address-family
!
address-family ipv4 vrf BLUE
redistribute connected
neighbor 172.16.2.2 remote-as 65200
neighbor 172.16.2.2 activate
exit-address-family
!
ip prefix-list DEFAULT-ONLY seq 10 permit 0.0.0.0/0
!
ip prefix-list INTERNAL seq 10 permit 10.0.0.0/8 le 32
ip prefix-list INTERNAL seq 20 permit 172.16.0.0/12 le 32
ip prefix-list INTERNAL seq 30 permit 192.168.0.0/16 le 32
!
ip prefix-list DENY-BOGONS seq 10 deny 0.0.0.0/8 le 32
ip prefix-list DENY-BOGONS seq 20 deny 127.0.0.0/8 le 32
ip prefix-list DENY-BOGONS seq 30 deny 169.254.0.0/16 le 32
ip prefix-list DENY-BOGONS seq 40 deny 224.0.0.0/4 le 32
ip prefix-list DENY-BOGONS seq 100 permit 0.0.0.0/0 le 24
!
route-map IMPORT-EBGP permit 10
match ip address prefix-list DENY-BOGONS
set local-preference 100
set community 65000:100 additive
!
route-map IMPORT-EBGP permit 20
set local-preference 50
!
route-map EXPORT-EBGP permit 10
match ip address prefix-list INTERNAL
!
route-map EXPORT-EBGP deny 100
!
route-map REDISTRIBUTE-STATIC permit 10
match tag 100
set metric 100
!
key chain EIGRP-KEY
key 1
key-string SecureKey123
accept-lifetime 00:00:00 Jan 1 2024 infinite
send-lifetime 00:00:00 Jan 1 2024 infinite
!
end
